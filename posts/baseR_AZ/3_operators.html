<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-03-04">
<meta name="description" content="Par2t one: Arithmetic, Logical and Relational operators">

<title>Jiří C. Moravec - Base R from A to Z: Operators (3)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jiří C. Moravec</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html">
 <span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/J-Moravec/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jcmoravec"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#operator-precedence" id="toc-operator-precedence" class="nav-link" data-scroll-target="#operator-precedence">Operator precedence</a></li>
  <li><a href="#arithmetic-operators" id="toc-arithmetic-operators" class="nav-link" data-scroll-target="#arithmetic-operators">Arithmetic operators</a></li>
  <li><a href="#logical-operators-and-functions" id="toc-logical-operators-and-functions" class="nav-link" data-scroll-target="#logical-operators-and-functions">Logical operators and functions</a>
  <ul>
  <li><a href="#logical-operators" id="toc-logical-operators" class="nav-link" data-scroll-target="#logical-operators">Logical operators</a></li>
  <li><a href="#logical-functions" id="toc-logical-functions" class="nav-link" data-scroll-target="#logical-functions">Logical functions</a></li>
  <li><a href="#conversion-rules" id="toc-conversion-rules" class="nav-link" data-scroll-target="#conversion-rules">Conversion rules</a></li>
  <li><a href="#raw-vectors" id="toc-raw-vectors" class="nav-link" data-scroll-target="#raw-vectors">Raw vectors</a></li>
  </ul></li>
  <li><a href="#relational-operators" id="toc-relational-operators" class="nav-link" data-scroll-target="#relational-operators">Relational operators</a>
  <ul>
  <li><a href="#string-comparisons" id="toc-string-comparisons" class="nav-link" data-scroll-target="#string-comparisons">String comparisons</a></li>
  <li><a href="#floating-point-comparisons" id="toc-floating-point-comparisons" class="nav-link" data-scroll-target="#floating-point-comparisons">Floating point comparisons</a></li>
  </ul></li>
  <li><a href="#group-generic-methods-and-ops" id="toc-group-generic-methods-and-ops" class="nav-link" data-scroll-target="#group-generic-methods-and-ops">Group generic methods and Ops</a>
  <ul>
  <li><a href="#double-dispatch" id="toc-double-dispatch" class="nav-link" data-scroll-target="#double-dispatch">Double dispatch</a></li>
  </ul></li>
  <li><a href="#example-sparse_vector" id="toc-example-sparse_vector" class="nav-link" data-scroll-target="#example-sparse_vector">Example: sparse_vector</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Base R from A to Z: Operators (3)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
  </div>
  </div>

<div>
  <div class="description">
    Par2t one: Arithmetic, Logical and Relational operators
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 4, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In the third part of the series about base R, we will talk about <strong>operators</strong>. As we have mentioned in the previous part, operators are construct similar to functions, but with special syntax or semantics. While you can call them as a functions, and there are instances where you want to do that, normally you call them in a special way called <em>infix</em> notation.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Infix, prefix and postfix
</div>
</div>
<div class="callout-body-container callout-body">
<p>Most of us are used to the classical <em>infix</em> notation, such as <code>3 + 5</code>. However, in some older programming languages, there is also a <em>prefix</em> notation <code>+ 3 5</code> and postfix notation <code>3 5 +</code>. These can be efficiently parsed using a <em>stack</em>, and do not require operator precedence.</p>
<p>Technically, R contains a traces of <em>prefix</em> notation in the form <code>"+"(3,5)</code> (or in fact, any functional call), but unlike in the typical prefix or postfix languages, the parentheses are required. Additionally, <code>!</code> is unary, and <code>-</code> and <code>+</code> have unary form, so they can be considered prefix, such as <code>-8</code> or <code>!a</code>.</p>
<p>For more information, see <a href="https://en.wikipedia.org/wiki/Infix_notation">infix</a>, <a href="https://en.wikipedia.org/wiki/Polish_notation">prefix</a> and <a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">postfix</a> on Wikipedia.</p>
</div>
</div>
<p>R offers a multitude of operators and a way to define new operators through the <code>%any%</code> notation. Operators can be divided into these groups:</p>
<ul>
<li>Arithmetic operators<br>
<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>, <code>%%</code>, <code>%/%</code></li>
<li>Logical operators<br>
<code>!</code>, <code>&amp;</code>, <code>&amp;&amp;</code>, <code>|</code>, <code>||</code></li>
<li>Relational operatos<br>
<code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>==</code>, <code>!=</code></li>
<li>Subsetting operators<br>
<code>[</code>, <code>[[</code>, <code>@</code>, <code>$</code></li>
<li>Assignment operators<br>
<code>&lt;-</code>, <code>&lt;&lt;-</code>, <code>=</code>, <code>[&lt;-</code>, <code>[[&lt;-</code>, <code>@&lt;-</code>, <code>$&lt;-</code></li>
<li>Matrix operators<br>
<code>%*%</code>, <code>%o%</code>, <code>%x%</code></li>
<li>Special operator<br>
<code>%anything%</code></li>
<li>Matching operator<br>
<code>%in%</code></li>
<li>Sequence operator<br>
<code>:</code></li>
<li>Operators in formula: <code>~</code>, <code>:</code>, <code>%in%</code></li>
<li>Namespace access: <code>::</code>, <code>:::</code></li>
<li>Parentheses and braces<br>
<code>(</code>, <code>{</code></li>
</ul>
<p>We will talk about Arithmetic, Logical, Relational, Subsetting, Assigment and Matrix operators, as well as the special operator <code>%anything%</code>. Matching operator is just a shorthand for the <code>match()</code> function, so we will leave it for later. The sequence operator <code>:</code> is a primitive for performance (and parsing) reasons, but we will talk about it together with other sequence-generating functions. The <code>::</code> and <code>:::</code> are quite complex, so we will talk about them when we go deeper into environments, namespaces and package access, and the <code>(</code> and <code>{</code> are language features rather than operators or functions, so we skip them for later. Finally, the <code>?</code> operator is not part of the <em>base</em>, but is in <em>utils</em>.</p>
</section>
<section id="operator-precedence" class="level2">
<h2 class="anchored" data-anchor-id="operator-precedence">Operator precedence</h2>
<p>From basic mathematics, we are used to the idea that multiplication precedes addition, so <code>3 + 5 * 2</code> is interpreted as <code>3 + (5 * 2)</code> without having to use parentheses. These rules are called <em>operator precedence</em>. Here I am reproducing the list from the <code>?Syntax</code> help command.</p>
<p>For listed operators, precedence goes from highest (evaluated first) to lowest. Operators with the same precedence are evaluated in the order they are encountered.</p>
<ul>
<li><code>::</code>, <code>:::</code></li>
<li><code>$</code>, <code>@</code></li>
<li><code>[</code>, <code>[[</code></li>
<li><code>^</code></li>
<li><code>-</code>, <code>+</code> in their unary form (<code>-3</code>, <code>+5</code>)</li>
<li><code>:</code></li>
<li><code>%any%</code>, <code>|&gt;</code> (base R pipe)</li>
<li><code>*</code>, <code>/</code></li>
<li><code>+</code>, <code>-</code> in their binary form (<code>3+5</code>)</li>
<li><code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code></li>
<li><code>!</code></li>
<li><code>&amp;</code>, <code>&amp;&amp;</code></li>
<li><code>|</code>, <code>||</code></li>
<li><code>~</code></li>
<li><code>-&gt;</code>, <code>-&gt;&gt;</code></li>
<li><code>&lt;-</code>, <code>&lt;&lt;-</code></li>
<li><code>=</code></li>
<li><code>?</code></li>
</ul>
<p>Now for some interesting consequences. With <code>^</code> having such high precedence, <code>-a^2</code> is interpeted as <code>-(a^2)</code> instead of <code>(-a)^2</code>, but then <code>-1:3</code> is interpeted as <code>(-1):3</code> and not <code>-(1:3)</code>.</p>
<p>The pipe <code>|&gt;</code> has high precedence, which mean you can’t do <code>a + 2 |&gt; ...</code>, because it is interpeted as <code>a + (2 |&gt; ...)</code>. This bites me all the time, when I just want to do some simple division or addition inside pipes.</p>
<p>Finally <code>=</code> has lower precedence than <code>&lt;-</code>. This shouldn’t be an issue since you should use either <code>=</code> or <code>&lt;-</code> as your assignment operator.</p>
<p>The takeway is that you should not rely on common sense your knowledge of operator precedence rules, but use parentheses to make operations as much explicit as possible.</p>
</section>
<section id="arithmetic-operators" class="level2">
<h2 class="anchored" data-anchor-id="arithmetic-operators">Arithmetic operators</h2>
<p>Arithmetic operators are addition <code>+</code>, subtraction <code>-</code>, multiplication <code>*</code>, division <code>/</code>, exponentiation <code>^</code>, modulo <code>%%</code> and integer division <code>%/%</code>.</p>
<p>The addition, subtraction, multiplication, division, and exponentiation are well known. Module and the integer division are less common, but occasionaly useful in programming. Modulo <code>%%</code> is the remainder after integer division, so that <code>5 %% 2 = 1</code>. The <code>%/%</code> is the integer division <code>5 %/% 2 = 2</code>. These are used when we want to know how many times something fit in our number, if we need to do something with a certain frequency, or if you want to know if a number is even. But arguably, some of these are displaced by sequence functions, and if we want to fit <code>k</code> elements into categories of size <code>m</code>, <code>ceiling(k/m)</code> gives us exactly that. So personally, I haven’t used modulo or integer division very often.</p>
<p>The <code>+</code> and <code>-</code> operators can be both unary and binary, meaning they accept one or two parameters. The meaning and behaviour, such as operator precedence, are different for the unary and binary version.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> a <span class="co"># unary `+`</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> a <span class="co"># unary `-`</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>a <span class="sc">+</span> b <span class="co"># binary `+`</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>a <span class="sc">-</span> b <span class="co"># binary `-`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is related to how numbers are parsed by the interpreter (see <a href="https://en.wikipedia.org/wiki/Literal_(computer_programming)">literals</a>. Details are not important, just remember that the unary and binary operators are different, and that the unary <code>-</code> makes numbers negative. Fun fact, as a consequence of the parsing rules, this is valid R code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> <span class="sc">-</span> <span class="sc">+</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="sc">-</span> <span class="sc">+</span> <span class="sc">-</span> <span class="sc">+</span> <span class="sc">+</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">+</span> <span class="sc">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<p>As with most fun facts, you should not ever write a code like this.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Recycling
</div>
</div>
<div class="callout-body-container callout-body">
<p>A lot of basic operations in R do something called <em>recycling</em>. For instance, when you add together two vectors with a different number of elements, the shorter vector is being extended by reusing (recycling) its elements.</p>
<p>For instance, consider multiplying a vector of length 3 with a vector of length 1: <code>c(1, 2, 3) * 3</code>. This is identical to <code>c(1,2,3) * c(3, 3, 3)</code> because the shorter vector is being recycled. This work well when the length of the longer vector is a multiple of the shorter vector (i.e., <code>longer %% shorter = 0</code>), for instance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>) <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 4 4 6 6 8</code></pre>
</div>
</div>
<p>You can see that the shorter vector was recycled as <code>c(1,2, 1,2, 1,2)</code>, because the length of the longer vector is a multiple of the shorter one. If this is not the case, the shorter vector is still recycled, but a warning is thrown.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">*</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in c(1, 2, 3) * c(1, 2): longer object length is not a multiple of
shorter object length</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 4 3</code></pre>
</div>
</div>
<p>Recycling allows you to do some fancy tricks, for example if you want to pick every second element of a vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)[<span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 4 6</code></pre>
</div>
</div>
<p>This works because the selection vector is being recycled to the full length using the predefined pattern.</p>
</div>
</div>
</section>
<section id="logical-operators-and-functions" class="level2">
<h2 class="anchored" data-anchor-id="logical-operators-and-functions">Logical operators and functions</h2>
<p>Since we are already talking about the logical operators, I thought it might be more useful to look more closely at the <em>logical</em> type and functions that operate with it.</p>
<p>Logical operators are negation <code>!</code>, which is a unary operator, and binary logical <em>and</em> <code>&amp;</code> and <code>&amp;&amp;</code>, logical <em>or</em> <code>|</code> and <code>||</code>. Aside of these operators, there is also a function <code>xor()</code>, helpers <code>isTRUE()</code>, <code>isFALSE()</code>, useful primitives <code>all()</code> and <code>any()</code>, and functions for the creation, testing, and conversion to the <em>logical</em> type: <code>logical()</code>, <code>is.logical()</code>, and <code>as.logical()</code>.</p>
<section id="logical-operators" class="level3">
<h3 class="anchored" data-anchor-id="logical-operators">Logical operators</h3>
<p>Logical operators are negation <code>!</code>, logical <em>and</em> <code>&amp;</code>, <code>&amp;&amp;</code>, and logical <em>or</em> <code>|</code>, <code>||</code>.</p>
<p>The negation <code>!</code> operator just makes a <code>FALSE</code> value <code>TRUE</code> and the other way around. The <em>and</em> and <em>or</em> operators are more interesting in the way they work on vectors.</p>
<p>The single symbol <em>and</em> and <em>or</em> operators <code>&amp;</code> and <code>|</code> work like <code>+</code> or <code>-</code>, they are applied element-wise and vectors are recycled as required.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>) <span class="sc">&amp;</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>) <span class="sc">|</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE</code></pre>
</div>
</div>
<p>The double-symbol <em>and</em> and <em>or</em> are not vectorized, they uses only the first element of a vector, while other elements are ignored. Likewise, the output of <code>&amp;&amp;</code> and <code>||</code> is a single <code>TRUE</code> or <code>FALSE</code> value. This makes <code>&amp;&amp;</code> and <code>||</code> useful when doing control flow operations with <code>if(condition){...}</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>) <span class="sc">&amp;&amp;</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>) <span class="co"># only the first value is used</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="logical-functions" class="level3">
<h3 class="anchored" data-anchor-id="logical-functions">Logical functions</h3>
<p>Now, lets move to the functions. The <code>isTRUE()</code> and <code>isFALSE()</code> are also useful shorthands for control flow. They detect if the condition is exactly <code>TRUE</code> or <code>FALSE</code> respectively, a good way to avoid pitalls with <code>NA</code>, <code>NULL</code>, which might arise from some operations and should be processed appropriatelly.</p>
<p>The logical operations <code>xor()</code> is elementwise exclusive <em>or</em>. It is not an operator, and not a primitive, likely because it is not used very often. You can see that <code>xor()</code> is just a shorthand for <code>(x | y) &amp; !(x &amp; y)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>xor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, y) 
{
    (x | y) &amp; !(x &amp; y)
}
&lt;bytecode: 0x5581b98bbef8&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<p>Very useful if <em>only</em> x <em>or</em> y are allowed, such as if you are using parameters as a mutually exclusive flags. Consider a function that does either <code>foo</code> or <code>bar</code>, but can’t do both at the same time:</p>
<pre><code>myfunc = function(x, doFoo=FALSE, doBar=FALSE){
    if(!xor(doFoo, doBar))
        stop("Must select either doFoo or doBar")

    if(doFoo)
        return(foo(x))
    if(doBar)
        return(bar(x))
    }</code></pre>
<p>Without <code>xor</code>, the function might not behave as expected, not returning anything if either both conditions are <code>FALSE</code>, or performing only one operation if both conditions are <code>TRUE</code>.</p>
<p>You can turn <code>xor()</code> easily into an <em>infix</em> operator <code>%xor%</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%xor%</span><span class="st">`</span> <span class="ot">=</span> xor</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">%xor%</span> <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Before we start talking about the <code>logical</code> type in general, lets quickly mention the <code>all()</code> and <code>any()</code>. These are vectorized and will tell you if <em>all</em> or <em>any</em> value of the vector are <code>TRUE</code> respectively. For efficiency reason, they are primitives, because they are used quite often for the control flow.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(vec) <span class="co"># will be FALSE because not all values are TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(vec) <span class="co"># TRUE as at least one value is TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>You can define a vectorized variant of <code>xor</code> which tells you that there is exactly one <code>TRUE</code> rather easily:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>one <span class="ot">=</span> <span class="cf">function</span>(x){</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    }   </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">one</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="co"># will be FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">one</span>(<span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="co"># will be TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="conversion-rules" class="level3">
<h3 class="anchored" data-anchor-id="conversion-rules">Conversion rules</h3>
<p>This brings us to an important step, conversion. You can apply logical operators not only on the logical <code>TRUE</code> and <code>FALSE</code> values, but as with many similar operations in R, the values are automatically converted to the correct type.</p>
<p>Conversion is performed internally using the <code>as.logical</code> primitive. Valid conversions are from <code>numeric</code> (that is, both <code>integer</code> and <code>double</code>), <code>complex</code>, and <code>character</code>. For the <code>numeric</code> and <code>complex</code>, <code>0</code> is converted into <code>FALSE</code> and non-zero value is converted into <code>TRUE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(5i<span class="sc">+</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>For the character type, the conversion is a bit more complex. The strings “T”, “TRUE”, “True” and “true” are converted into <code>TRUE</code>, and similarly “F”, “FALSE”, “False” and “false” are converted into <code>FALSE</code>. Everything else, including “TrUe” and similar messy capitalizations, is converted into <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="fu">c</span>(<span class="st">"T"</span>, <span class="st">"TRUE"</span>, <span class="st">"True"</span>, <span class="st">"true"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"FALSE"</span>, <span class="st">"False"</span>, <span class="st">"false"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"0"</span>, <span class="st">"truE"</span>, <span class="st">"foo"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA NA NA NA</code></pre>
</div>
</div>
<p>The <code>logical(n)</code> is a shorthand for <code>vector("logical", n)</code> and simply create a logical vector of length <code>n</code> with values initialized to <code>FALSE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logical</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>When converting from logical to numeric, the <code>TRUE</code> and <code>FALSE</code> converts to <code>1</code> and <code>0</code> respectively. This allows for the convenient use of <code>sum</code> or <code>mean</code> to count the number or the percentage of matches. When converting from logical to character, the <code>TRUE</code> and <code>FALSE</code> gets converted simply to <code>"TRUE"</code> and <code>"FALSE"</code> strings.</p>
</section>
<section id="raw-vectors" class="level3">
<h3 class="anchored" data-anchor-id="raw-vectors">Raw vectors</h3>
<p>The logical operators <code>!</code>, <code>&amp;</code> and <code>|</code> have another meaning for raw vectors. <code>raw</code> is a basic type, alongside <code>integer</code>, <code>double</code>, <code>list</code>, and so on. It represents raw bytes (from 0 to 255), here printed in a hexadecimal format:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.raw</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">255</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 00 0a ff</code></pre>
</div>
</div>
<p>For these raw vectors, the logical operators have a slightly different bitwise meaning. See <code>bitwNot</code>, <code>botwAnd</code>, and <code>bitwOr</code> for <code>!</code>, <code>&amp;</code>, and <code>|</code> respectively. We will talk in-depth about raw type and operations on them later in this series.</p>
</section>
</section>
<section id="relational-operators" class="level2">
<h2 class="anchored" data-anchor-id="relational-operators">Relational operators</h2>
<p>Relational operatos are <em>smaller than</em> <code>&gt;</code>, <em>larger than</em> <code>&gt;</code>, <em>smaller or equal</em> <code>&lt;=</code>, _larger or equal <code>&gt;=</code>, equal <code>==</code>, and not equal <code>!=</code>. For <code>numeric</code> (<code>integer</code> and <code>double</code>) and <code>logical</code> (which is converted to numeric), the comparisons are what you might expect, just a standard numerical comparisons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>5L <span class="sc">&gt;</span> 2L <span class="co"># integers, the `long` type</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fl">5.3</span> <span class="sc">&gt;</span> <span class="fl">2.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">&gt;</span> <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>For <code>raw</code>, the numeric order is used so the comparisons also behaves as expected, and for <code>complex</code>, only the <code>==</code> and <code>!=</code> comparisons are implemented.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.raw</span>(<span class="dv">5</span>) <span class="sc">&gt;</span> <span class="fu">as.raw</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">+</span>1i <span class="sc">&gt;</span> <span class="dv">2</span><span class="sc">+</span>1i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in 5 + (0+1i) &gt; 2 + (0+1i): invalid comparison with complex values</code></pre>
</div>
</div>
<section id="string-comparisons" class="level3">
<h3 class="anchored" data-anchor-id="string-comparisons">String comparisons</h3>
<p>For <code>character</code> strings, the comparisons are quite a bit more complicated. If you consider only standard english alphabet, the problem might feel obvious. But every language has slightly different rules about order of character in their alphabet. Quoting from the R help page:</p>
<blockquote class="blockquote">
<p>Beware of making <em>any</em> assumptions about the collation order: e.g.&nbsp;in Estonian ‘Z’ comes between ‘S’ and ‘T’, and collation is not necessarily character-by-character - in Danish ‘aa’ sorts as a single letter, after ‘z’. In Welsh ‘ng’ may or may not be a single sorting unit: if it is it follows ‘g’.</p>
</blockquote>
<p>On top of this, the order is system and locale dependent. This makes sorting extremely unpredictable when comparing strings accross languages.</p>
<p>For more information, see <a href="https://learn.microsoft.com/en-us/globalization/locale/sorting-and-string-comparison">Microsoft page</a> or <a href="http://unicode.org/reports/tr10/">long unicode explanation</a>.</p>
<p>I am happy that smarter people solved it and I don’t need to know the details.</p>
</section>
<section id="floating-point-comparisons" class="level3">
<h3 class="anchored" data-anchor-id="floating-point-comparisons">Floating point comparisons</h3>
<p>There is a caveat when comparing <code>doubles</code>. You might remember that computers work in a binary. This means that every number is represented by combination of bits that can be <code>0</code> or <code>1</code>. You might start sensing that something is off in here. How can I represent a rational number by just combination of <code>0</code> and <code>1</code>? This is because computers are able to represent perfectly only whole numbers, <code>integer</code>. Anything else is represented imperfectly and you get rounding errors. R is trying to hide this imperfection by rounding when printing, but the abstraction will leak if you try to compare for equality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.9</span>) <span class="sc">==</span> <span class="fl">0.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>The <code>&gt;</code> and <code>&lt;</code> still works as intended, but when you are comparing floating point numbers, use <code>all.equal</code> instead and select an appropriate precision (by default <code>sqrt(.Machine$double.eps)</code> is used):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>( (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.9</span>), <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Unlike with string comparison, this is common issue that will significantly influence the performance of your code, especially if you are writing any kind of numerical algorithm. You need to be aware of these issues. See <a href="https://floating-point-gui.de/">shorter explanation</a> and <a href="https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">longer explanation</a> and try to understand them.</p>
</section>
</section>
<section id="group-generic-methods-and-ops" class="level2">
<h2 class="anchored" data-anchor-id="group-generic-methods-and-ops">Group generic methods and Ops</h2>
<p>Some methods are grouped into groups called <em>group generics</em> functions. These methods are dispatched when any of the grouped functions are called. While it might look strange at first look, this allows for some neat tricks to efficiently define common mathematical operations for a large group of functions.</p>
<p>For instance, consider <code>Ops.POSIXt</code> which defines <em>arithmetic</em>, <em>logical</em> and <em>relational</em> operators for the S3 class <code>POSIXt</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>Ops.POSIXt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (e1, e2) 
{
    if (nargs() == 1L) 
        stop(gettextf("unary '%s' not defined for \"POSIXt\" objects", 
            .Generic), domain = NA)
    boolean &lt;- switch(.Generic, `&lt;` = , `&gt;` = , `==` = , `!=` = , 
        `&lt;=` = , `&gt;=` = TRUE, FALSE)
    if (!boolean) 
        stop(gettextf("'%s' not defined for \"POSIXt\" objects", 
            .Generic), domain = NA)
    if (inherits(e1, "POSIXlt") || is.character(e1)) 
        e1 &lt;- as.POSIXct(e1)
    if (inherits(e2, "POSIXlt") || is.character(e2)) 
        e2 &lt;- as.POSIXct(e2)
    check_tzones(e1, e2)
    NextMethod(.Generic)
}
&lt;bytecode: 0x5581bc403cb8&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<p>First, the function checks if only a single argument was passed, because unary operators are not defined.</p>
<p>Then it uses <code>switch</code> statement, which evaluates to <code>TRUE</code> if one of <code>&lt;</code>, <code>&gt;</code>, <code>==</code>, <code>!=</code>, <code>&lt;=</code>, and <code>&gt;=</code> matches the <code>.Generic</code> variable, which is an automatic variable initialized to the dispatched generics from the <code>Ops</code> group. So if the function call was <code>!POSIXt</code>, the <code>.Generic</code> is the negation operator <code>!</code>. The <code>switch</code> statement thus works as a check whether a particular operator makes sense for the class, throwing error if the operation was not defined.</p>
<p>This doesn’t mean that operators not specified in the switch are undefined. In fact, both <code>+.POSIXt</code> and <code>-.POSIXt</code> exists.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
POSIXt, POSIXlt and POSIXct
</div>
</div>
<div class="callout-body-container callout-body">
<p>R contains a number of different classes for dates.</p>
<p><code>POSIXct</code> is a signed number of seconds since the begining of 1970 (UCT time zone), the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix time</a>.</p>
<p><code>POSIXlt</code> is a named list of vectors with <code>sec</code>, <code>min</code>, <code>hour</code>, <code>mday</code> and so on.</p>
<p><code>POSIXct</code> is a really simple and convenient way to keep time, but not very human readable (unless you are Unix guru). <code>POSIXlt</code> is a nice human-readable format, but not very convenient when you want to store precise times in a <code>data.frame</code></p>
<p><code>POSIXt</code> is a virtual class, both <code>POSIXct</code> and <code>POSIXlt</code> inherits from it. This means that when you define a method for <code>POSIXt</code>, it will automatically work for <code>POSIXct</code> and <code>POSIXlt</code>.</p>
</div>
</div>
<p>Since <code>POSIXt</code> is a virtual class, and math with a number of seconds <code>POSIXct</code> is simpler than math on a complex data structure <code>POSIXlt</code> (see the box), what follows is a conversion into <code>POSIXct</code>, and the call to <code>NextMethod()</code>, which simply calls the appropriate method for the <code>.Generic</code> on the modified parameters. There is nothing simple on <code>NextMethod()</code> and we will talk about it later, when we are talking in-depth about the S3 system.</p>
<section id="double-dispatch" class="level3">
<h3 class="anchored" data-anchor-id="double-dispatch">Double dispatch</h3>
<p>Methods in the <code>Ops</code> group are special because most of them are binary and they need to do something called <a href="https://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a>. For instance, if you are adding objects of class <code>foo</code> and <code>bar</code>, you need to dispatch the correct method for this particular addition, taking in account classes of both objects, not just <code>foo</code> or <code>bar</code> independently. To keep addition comutative, method needs should be identical even if the order of addition is changed (<code>bar + foo</code>).</p>
<p>S3 has rather primitive double-dispatch system, the rules are as follows:</p>
<ol type="1">
<li>If neither objects has a method, use internal method.</li>
<li>If only one object has a method, use that method.</li>
<li>If both objects have a method, and the methods:
<ol type="a">
<li>are identical, use that method.</li>
<li>are not identical, throw a warning and use internal methods.</li>
</ol></li>
</ol>
<p>To demonstrate this, we define a helper function and methods for the <code>+</code> generic for classes <code>foo</code> and <code>bar</code>. These simply return <code>NULL</code> and print a message, which will tell us which method was dispatched.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># helper to make object less wordy</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>obj <span class="ot">=</span> <span class="cf">function</span>(class){</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">structure</span>(<span class="dv">1</span>, <span class="at">class=</span>class)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+.foo</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(...){<span class="fu">message</span>(<span class="st">"foo"</span>)}</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+.bar</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(...){<span class="fu">message</span>(<span class="st">"bar"</span>)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first rule is just a normal addition:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>According to the second rule, the <code>+.foo</code> method is dispatched:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="fu">obj</span>(<span class="st">"foo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>foo</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj</span>(<span class="st">"foo"</span>) <span class="sc">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>foo</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj</span>(<span class="st">"foo"</span>) <span class="sc">+</span> <span class="fu">obj</span>(<span class="st">"baz"</span>) <span class="co"># no method +.baz</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>foo</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>According to the third rule, since methods are not identical, we will get a warning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj</span>(<span class="st">"foo"</span>) <span class="sc">+</span> <span class="fu">obj</span>(<span class="st">"bar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Incompatible methods ("+.foo", "+.bar") for "+"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
attr(,"class")
[1] "foo"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj</span>(<span class="st">"bar"</span>) <span class="sc">+</span> <span class="fu">obj</span>(<span class="st">"foo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Incompatible methods ("+.bar", "+.foo") for "+"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
attr(,"class")
[1] "bar"</code></pre>
</div>
</div>
<p>Finally, if we redefine the <code>+.foo</code> and the <code>+.bar</code> to be identical, addition works again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+.foo</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(...){<span class="fu">message</span>(<span class="st">"foobar"</span>)}</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+.bar</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(...){<span class="fu">message</span>(<span class="st">"foobar"</span>)}</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">obj</span>(<span class="st">"foo"</span>) <span class="sc">+</span> <span class="fu">obj</span>(<span class="st">"bar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>foobar</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>Notice that if one of the object doesn’t have defined an S3 method, we can make the S3 method that is dispatched quite complex and built-in support for different types. But this mechanism will be fragile and once someone defines method for one of the supported types, our method would be ignored and the dispatch would default to an internal method (with warning). For an explicit double dispatch system that can be further extended, we would need to go for S4 classes.</p>
</section>
</section>
<section id="example-sparse_vector" class="level2">
<h2 class="anchored" data-anchor-id="example-sparse_vector">Example: sparse_vector</h2>
<p>As an example, we will create an S3 class <code>sparse_vector</code>. There is an S4 class in the <code>Matrix</code> package, which is a more reasonable choice since S4 methods can be extended, but we do this only for demonstration purposes.</p>
<p>First, we will define our class, sparse vector is defined by the vector of values <code>x</code>, vector of indices <code>i</code> and the length of the vector. Normally, we would make a barebone <code>new_sparse_vector</code> constructor, and the <code>sparse_vector</code> one would be an interface that would also check validity of input parameters, but we will keep it simple.</p>
<p>We also create a method for the <code>as.vector</code> generics, so that we can easily unroll our sparse vector into a normal one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>sparse_vector <span class="ot">=</span> <span class="cf">function</span>(x, i, length){</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">structure</span>(<span class="fu">list</span>(</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> x,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">i =</span> i,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">length =</span> length</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>        ), <span class="at">class =</span> <span class="st">"sparse_vector"</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>as.vector.sparse_vector <span class="ot">=</span> <span class="cf">function</span>(x, ...){</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">=</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="fu">mode</span>(x<span class="sc">$</span>x), <span class="at">length=</span>x<span class="sc">$</span>length)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    y[x<span class="sc">$</span>i] <span class="ot">=</span> x<span class="sc">$</span>x</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    y</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>print.sparse_vector <span class="ot">=</span> <span class="cf">function</span>(x, ...){</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">"."</span>, x<span class="sc">$</span>length)</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>    y[x<span class="sc">$</span>i] <span class="ot">=</span> <span class="fu">as.character</span>(x<span class="sc">$</span>x)</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(y, <span class="at">quote=</span><span class="cn">FALSE</span>)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">sparse_vector</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">8</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>), <span class="dv">10</span>)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] . 3 . 5 . 8 . . . .</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.vector</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 3 0 5 0 8 0 0 0 0</code></pre>
</div>
</div>
<p>We want to support all operations in the group generics <code>Ops</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>Ops.sparse_vector <span class="ot">=</span> <span class="cf">function</span>(e1, e2){</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">inherits</span>(e1, <span class="st">"sparse_vector"</span>))</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>        e1 <span class="ot">=</span> <span class="fu">as.vector</span>(e1)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If Ops is unary, e2 is missing</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">missing</span>(e2) <span class="sc">&amp;&amp;</span> <span class="fu">inherits</span>(e2, <span class="st">"sparse_vector"</span>))</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>        e2 <span class="ot">=</span> <span class="fu">as.vector</span>(e2)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NextMethod</span>(.Generic)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>a <span class="sc">+</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2  5  2  7  2 10  2  2  2  2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2  5  2  7  2 10  2  2  2  2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>a <span class="sc">*</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0  6  0 10  0 16  0  0  0  0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>a <span class="sc">==</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0 -3  0 -5  0 -8  0  0  0  0</code></pre>
</div>
</div>
<p>And essentially for free, we suddenly support all operations. But this isn’t very efficient if we are summing two sparse vectors, for instance. So for some operations, we define their own functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+.sparse_vector</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(e1, e2){</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"+.sparse_vector dispatched"</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nargs</span>() <span class="sc">==</span> 1L)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(e1)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">inherits</span>(e1, <span class="st">"sparse_vector"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">inherits</span>(e2, <span class="st">"sparse_vector"</span>)){</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>        i <span class="ot">=</span> <span class="fu">union</span>(e1<span class="sc">$</span>i, e2<span class="sc">$</span>i) <span class="sc">|&gt;</span> <span class="fu">sort</span>()</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>        j <span class="ot">=</span> <span class="fu">intersect</span>(e1<span class="sc">$</span>i, e2<span class="sc">$</span>i) <span class="sc">|&gt;</span> <span class="fu">sort</span>()</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>        l <span class="ot">=</span> <span class="fu">max</span>(e1<span class="sc">$</span>length, e2<span class="sc">$</span>length) <span class="co"># ignoring recycling for now</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>        y <span class="ot">=</span> <span class="fu">sparse_vector</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(i)), i, l)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>        y<span class="sc">$</span>x[i <span class="sc">%in%</span> e1<span class="sc">$</span>i] <span class="ot">=</span> e1<span class="sc">$</span>x</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>        y<span class="sc">$</span>x[i <span class="sc">%in%</span> e2<span class="sc">$</span>i] <span class="ot">=</span> e2<span class="sc">$</span>x</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>        y<span class="sc">$</span>x[i <span class="sc">%in%</span> j] <span class="ot">=</span> e1<span class="sc">$</span>x[e1<span class="sc">$</span>i <span class="sc">%in%</span> j] <span class="sc">+</span> e2<span class="sc">$</span>x[e2<span class="sc">$</span>i <span class="sc">%in%</span> j]</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(y)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">inherits</span>(e1, <span class="st">"sparse_vector"</span>)){</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>        e2[e1<span class="sc">$</span>i] <span class="ot">=</span> e2[e1<span class="sc">$</span>i] <span class="sc">+</span> e1<span class="sc">$</span>x</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(e2)</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">inherits</span>(e2, <span class="st">"sparse_vector"</span>)){</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>        e1[e2<span class="sc">$</span>i] <span class="ot">=</span> e1[e2<span class="sc">$</span>i] <span class="sc">+</span> e2<span class="sc">$</span>x</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(e1)</span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"This should be unreachable state"</span>)</span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">sparse_vector</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">6</span>), <span class="dv">10</span>)</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>+.sparse_vector dispatched</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] . 3 . 5 . 8 . . . .</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>+.sparse_vector dispatched</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 . . 2 . 3 . . . .</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>a <span class="sc">+</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>+.sparse_vector dispatched</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1  3  .  7  .  11 .  .  .  . </code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>a <span class="sc">+</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>+.sparse_vector dispatched</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 4 1 6 1 9 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>b <span class="sc">+</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>+.sparse_vector dispatched</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2 1 1 3 1 4 1 1 1 1</code></pre>
</div>
</div>
<p>The code isn’t perfect, we ignore a lot of recycling, which means operations with matrices will not work correctly, and so on. But as an example of the <code>Ops</code> and operator overloading, this should be sufficient. One obvious improvement would be redefining the operator <code>[</code> to make subsetting of the vector much easier, and thus the code cleaner. We will look at this in the next article.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this part, we have learned about operators, and more closely explored arithmetic, logical and relational operators. On top of this, we have learned more about group generic functions, double dispatch system, and managed to implement a simple <code>sparse_vector</code> class with working arithmetic, logical and relational operators.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>