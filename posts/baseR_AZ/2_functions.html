<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-02-21">
<meta name="description" content="Closures, primitives and internals">

<title>Jiří C. Moravec - Base R from A to Z: Types of functions (2)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jiří C. Moravec</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html">
 <span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#types-of-functions" id="toc-types-of-functions" class="nav-link" data-scroll-target="#types-of-functions">Types of functions</a>
  <ul>
  <li><a href="#primitives" id="toc-primitives" class="nav-link" data-scroll-target="#primitives">Primitives</a></li>
  <li><a href="#generics" id="toc-generics" class="nav-link" data-scroll-target="#generics">Generics</a></li>
  <li><a href="#generic-primitives" id="toc-generic-primitives" class="nav-link" data-scroll-target="#generic-primitives">Generic primitives</a></li>
  <li><a href="#operator-overloading" id="toc-operator-overloading" class="nav-link" data-scroll-target="#operator-overloading">Operator overloading</a></li>
  <li><a href="#special-vs-builtin" id="toc-special-vs-builtin" class="nav-link" data-scroll-target="#special-vs-builtin">special vs builtin</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Base R from A to Z: Types of functions (2)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
  </div>
  </div>

<div>
  <div class="description">
    Closures, primitives and internals
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 21, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In the second part of the series about the base R, I wanted originally to talk about operators. But to talk about properators properly, I wanted to explore how operators are defined first and the difference between classical functions and something called primitives. In the end, the <em>small segway</em> got a bit too big, so I decided to release it as an independent article.</p>
</section>
<section id="types-of-functions" class="level2">
<h2 class="anchored" data-anchor-id="types-of-functions">Types of functions</h2>
<blockquote class="blockquote">
<p>To understand computations in R, two slogans are helpful:</p>
<ul>
<li><p>Everything that exists is an object.</p></li>
<li><p>Everything that happens is a function call.</p>
<p>– John Chambers (author of S, coauthor of R)</p></li>
</ul>
</blockquote>
<p>As per the quote, everything that happens in R is a function call. Operators are construct similar to functions, but with special syntax or semantics. But you might have realized that not every function is the same and that R has different types of functions.</p>
<p>For instance, when you write the name of a standard function, you will print their code. This doesn’t work with operators and other language elements. To operate with them, you need to escape them, either with quotation marks <code>"</code> or backticks <code>`</code>. Backticks typically work in most occassions. For instance, we can use backticks to print help of <code>+</code>, print the body of <code>-</code> or call <code>*</code> as if it was a function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>?<span class="st">`</span><span class="at">+</span><span class="st">`</span> <span class="co"># prints a help-page of +</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">-</span><span class="st">`</span> <span class="co"># prints the body of -</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (e1, e2)  .Primitive("-")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">*</span><span class="st">`</span>(<span class="dv">3</span>,<span class="dv">5</span>) <span class="co"># call as if * was a normal function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
</div>
<p>Operators are special kind of functions, but so are other language elements like <code>for</code>, <code>return</code>, or in fact even <code>(</code> and <code>{</code>. But unlike with operators, calling language elements like a function doesn’t work. We will talk about these language elements in detail some other time.</p>
<p>These special functions are called <em>primitives</em>. Primitives are special in many ways. Outside of primitives, all other functions are standard functions that either call R code, or call a compiled C or Fortran code through the interfaces <code>.Internal</code>, <code>.External</code>, <code>.C</code>, <code>.Call</code> or <code>.Fortran</code>.</p>
<p>To explore these function types in <code>base</code>, we will define a helper functions. And because there would be a lot of repeated code, we will construct these functions with a function factory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>is_function_type_factory <span class="ot">=</span> <span class="cf">function</span>(pattern, <span class="at">fixed=</span><span class="cn">TRUE</span>){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">force</span>(fixed) <span class="co"># force evaluation</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x){</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.function</span>(x))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        body <span class="ot">=</span> <span class="fu">body</span>(x)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.null</span>(body))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="cn">FALSE</span>) <span class="co"># primitives don't have body</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">deparse</span>(body) <span class="sc">|&gt;</span> <span class="fu">grep</span>(<span class="at">pattern=</span>pattern, <span class="at">fixed=</span>fixed) <span class="sc">|&gt;</span> <span class="fu">any</span>()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>is.internal <span class="ot">=</span> <span class="fu">is_function_type_factory</span>(<span class="st">".Internal"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>is.external <span class="ot">=</span> <span class="fu">is_function_type_factory</span>(<span class="st">".External"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>is.ccall    <span class="ot">=</span> <span class="fu">is_function_type_factory</span>(<span class="st">".C"</span>) <span class="co"># will match .C and .Call</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>is.fortran  <span class="ot">=</span> <span class="fu">is_function_type_factory</span>(<span class="st">".Fortran"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all functions from base, we did this before</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>functions <span class="ot">=</span> <span class="fu">Filter</span>(is.function, <span class="fu">sapply</span>(<span class="fu">ls</span>(<span class="fu">baseenv</span>()), get, <span class="fu">baseenv</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So out of 1242, there are 185 primitives, 415 internals, 0 external calls, 3 calls using the <code>.C</code> or <code>.Call</code> interface, 6 calls to Fortran, with the rest being pure R functions.</p>
<section id="primitives" class="level3">
<h3 class="anchored" data-anchor-id="primitives">Primitives</h3>
<p>Primitives are special functions that form the core of R language. Normal functions (called <em>closures</em> in R) have a list of arguments called <em>formals</em>, a <em>body</em>, and an enclosing <em>environment</em> (thus called <em>closures</em>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># formals, body and environment of `is.internal`</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>not_null <span class="ot">=</span> <span class="fu">Negate</span>(is.null)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>has_fbe <span class="ot">=</span> <span class="cf">function</span>(x){<span class="fu">c</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formals"</span>     <span class="ot">=</span> <span class="fu">formals</span>(x) <span class="sc">|&gt;</span> <span class="fu">not_null</span>(),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"body"</span>        <span class="ot">=</span> <span class="fu">body</span>(x) <span class="sc">|&gt;</span> <span class="fu">not_null</span>(),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"environment"</span> <span class="ot">=</span> <span class="fu">environment</span>(x) <span class="sc">|&gt;</span> <span class="fu">not_null</span>()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    )}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">has_fbe</span>(is.internal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    formals        body environment 
       TRUE        TRUE        TRUE </code></pre>
</div>
</div>
<p>Compared to normal functions, primitives do not have any <em>formals</em>, <em>body</em>, or enclosing <em>environment</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">has_fbe</span>(<span class="st">`</span><span class="at">-</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    formals        body environment 
      FALSE       FALSE       FALSE </code></pre>
</div>
</div>
<p>This is why we put an additional check for <code>body(x) |&gt; is.null()</code> in our function factory. So what about the printed body of <code>-</code> that we saw before? It was a fake! R is lying to us here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">-</span><span class="st">`</span> <span class="co"># output of this is fake</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (e1, e2)  .Primitive("-")</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>minus <span class="ot">=</span> <span class="cf">function</span>(e1, e2) <span class="fu">.Primitive</span>(<span class="st">"-"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>minus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function(e1, e2) .Primitive("-")</code></pre>
</div>
</div>
<p>See the extra space in the original <code>-</code>? Now watch this. Calling <code>minus(1,2)</code> just prints the original <code>-</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">minus</span>(<span class="dv">1</span>,<span class="dv">2</span>) <span class="co"># just prints the original `-`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (e1, e2)  .Primitive("-")</code></pre>
</div>
</div>
<p>To get the correct result, we need to call <code>minus()(1,2)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">minus</span>()(<span class="dv">1</span>,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1</code></pre>
</div>
</div>
<p>This is because our function returns the <code>.Primitive("-")</code> which then performs the actual call to the <code>-</code> primitive.</p>
<p>All the special language elements like <code>for</code>, <code>(</code> are primitives, so are the functions like <code>.Internal</code> or <code>.Call</code> that communicate with the internal or external libraries. Finally, there is also a performance consideration, many non-special functions are primitives because these call need to be performant.</p>
</section>
<section id="generics" class="level3">
<h3 class="anchored" data-anchor-id="generics">Generics</h3>
<p>One reason why I am talking about these types of functions is because of generics. Generics<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> are types of functions that when called, they dispatch a function specific to the type of input object. Typically, the type of object is called a <em>class</em>, and the specific function is called a <em>method</em>. This is the core of the S3 object-oriented system. For instance, in most cases you don’t need to worry what kind of object you are working with and call <code>print</code> anyway, which will then dispatch an appropriate method based for the class of the object, such as <code>print.data.frame</code> or <code>print.Date</code>. This makes interactive use quite convenient, but also allows you to write a more generic code. For instance, instead of having to expect every single possible class in your function, you can rest assured that <code>as.character</code> will provide you a reasonable output.</p>
<p>Typical S3 generic functions would look like this:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>function (x, ...) 
UseMethod("print")
&lt;bytecode: 0x55926d523a58&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<p>Just a single call to <code>UseMethod("print")</code> alternatively <code>UseMethod("print", x)</code> to make the object for which the method will be dispatched (<code>x</code> in this case) explicit. Notice that no other argument parsing is happening there, this is done behind the curtain.</p>
</section>
<section id="generic-primitives" class="level3">
<h3 class="anchored" data-anchor-id="generic-primitives">Generic primitives</h3>
<p>Primitives can be generics as well, even without the use of <code>UseMethod</code>. There are a few ways how this is achieved.</p>
<p>First of all, there are S3 prototype functions in the <code>.GenericsArgsEnv</code> environment. They look like your standard S3 generic function, just a call to <code>UseMethod</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>get_objects <span class="ot">=</span> <span class="cf">function</span>(x){</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.character</span>(x))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        x <span class="ot">=</span> <span class="fu">getNamespace</span>(x)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(x <span class="sc">|&gt;</span> <span class="fu">ls</span>(), get, x)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>primitive_generics <span class="ot">=</span> <span class="fu">get_objects</span>(.GenericArgsEnv)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>primitive_generics[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`-`
function (e1, e2) 
UseMethod("-")
&lt;bytecode: 0x55926ad92ec8&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>primitive_generics <span class="sc">|&gt;</span> <span class="fu">names</span>() <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "-"   "!"   "!="  "*"   "/"   "&amp;"   "%/%" "%%"  "^"   "+"  </code></pre>
</div>
</div>
<p>However, I am not sure if they are actually used during calls or are there for other reason, such as documentation. There is a similar environment <code>.ArgsEnv</code> that contains primitives that are not generics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>primitive_not_generic <span class="ot">=</span> <span class="fu">get_objects</span>(.ArgsEnv)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>primitive_not_generic[[<span class="st">"seq_len"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (length.out) 
NULL
&lt;bytecode: 0x55926ad81b20&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<p>These functions, when executed, just return <code>NULL</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>primitive_not_generic[[<span class="st">"seq_len"</span>]](<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>Compare this to a standard call to <code>seq_len</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_len</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
</div>
<p>This suggests that these functions, likely both <code>.GenericsArgsEnv</code> and <code>.ArgsEnv</code> are not involved in the function dispatch, or if they are, they are involved much later after the <code>.Primitive()</code> call is evaluated.</p>
<p>This brings us to the second way how primitives can be generic. But this dispatch is being performed directly in the internal C code using either the <code>DispatchOrEval</code> call or <code>DispatchGeneric</code>. I will stop here and won’t got deeper, because the situation is quickly getting complicated. For instance, despite the manual saying that something called group generics are using the <code>DispatchGeneric</code>, this is not actually the case and this function doesn’t exist in the C code. Instead, many generics are grouped, thus <em>called group</em>, have a complex system of dispatching based utilizing <code>DispatchGroup</code> (instead of <code>DispatchGeneric</code>), <code>switch</code> and integer values likely related to the functions in the <code>src/main/names.c</code> source code.</p>
<p>You can see which functions are <em>group generics</em> in two ways, reading the help file for <code>?groupGeneric</code> (it has no associated object) or by removing non-group generic functions from all primitive generics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(primitive_generics <span class="sc">|&gt;</span> <span class="fu">names</span>(), .S3PrimitiveGenerics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "-"        "!"        "!="       "*"        "/"        "&amp;"       
 [7] "%/%"      "%%"       "^"        "+"        "&lt;"        "&lt;="      
[13] "=="       "&gt;"        "&gt;="       "|"        "abs"      "acos"    
[19] "acosh"    "all"      "any"      "Arg"      "asin"     "asinh"   
[25] "atan"     "atanh"    "ceiling"  "Conj"     "cos"      "cosh"    
[31] "cospi"    "cummax"   "cummin"   "cumprod"  "cumsum"   "digamma" 
[37] "exp"      "expm1"    "floor"    "gamma"    "Im"       "lgamma"  
[43] "log"      "log10"    "log1p"    "log2"     "max"      "min"     
[49] "Mod"      "prod"     "range"    "Re"       "round"    "sign"    
[55] "signif"   "sin"      "sinh"     "sinpi"    "sqrt"     "sum"     
[61] "tan"      "tanh"     "tanpi"    "trigamma" "trunc"   </code></pre>
</div>
</div>
<p>Note that these lists of functions are not generated from the C source code, so there is no way other than reading the C source code to know if a primitive function is generic or not.</p>
</section>
<section id="operator-overloading" class="level3">
<h3 class="anchored" data-anchor-id="operator-overloading">Operator overloading</h3>
<p>Equations would be quite messy if you had to write a different <code>+</code> for scalars, vector and matrices. In case of operators, this is called <a href="https://en.wikipedia.org/wiki/Operator_overloading">operator overloading</a> and can be a dangerous tool if not done carefully.</p>
<p>The whole point of operator overloading is that you can have quite complex objects and operate with them in a nice and polite manner as long as the semantics of operators make sense. For instance, the <code>Matrix</code> package defines sparse matrices. Sparse matrices are matrices where the majority of elements are equal to zero. Because of this, it is quite a bit more efficient if they are respresented not as a standard matrix with <code>n*m</code> elements, but with a special representation where you represent only elements that are non-zero. This saves memory and makes some operations faster. At the same time, you want them to behave like standard matrices with operations like addition, multiplication, or subsetting. So in standard S3 way (or S4 in this case), you overload the <code>+</code> operator to dispatch a particular function for addition of two standard matrices, one standard and one sparse, or two sparse matrices. From user perspective, nothing has changed and the operation looks the same <code>M + N</code> regardless of what types the matrices are summed. In languages like Java, which forgeos operator overloading in favour of heavy object-oriented system, you would have to do something of this sort:</p>
<pre><code># without operator overloading
M.add(N)</code></pre>
<p>You can see that complex equation might look quite messy due to this. At least Java has <a href="https://en.wikipedia.org/wiki/Function_overloading">function overloading</a>. Without that, you would have to detect the particular type of objects and dispatch an appropriate function by yourself. This is exactly what the R source code written in C has to do.</p>
<p>Note that this operator overloading does not always work and you can’t easily overload operators for basic types. For instance, some languages like to overload the <code>+</code> operator for the addition of strings, performing string concatenation. This makes sense in some cases, doesn’t in other cases and is another contentious problems, there is a whole discussion about this on the <a href="https://www.stat.math.ethz.ch/pipermail/r-devel/2006-August/038991.html">R mailing list</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+.character</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(x,y){<span class="fu">paste0</span>(x,y)}</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="st">"foo"</span> <span class="sc">+</span> <span class="st">"bar"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in "foo" + "bar": non-numeric argument to binary operator</code></pre>
</div>
</div>
<p>This is <code>character</code> is a basic type, which do not have a class and thus do not immediatelly work with all primitive generics this way. What matters here is the attribute <code>class</code> that is added to S3 objects. But if you try to explore this attribute with the <code>class()</code>, R will lie to you. You need to use the <code>oldClass()</code> function to see the S3 attribute.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="st">"foo"</span>) <span class="co"># will lie to you</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">oldClass</span>(<span class="st">"foo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>This overloading will work well for user-defined S3 classes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+.foobar</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(x,y){<span class="fu">paste0</span>(x,y)}</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structure</span>(<span class="st">"foo"</span>, <span class="at">class =</span> <span class="st">"foobar"</span>) <span class="sc">+</span> <span class="fu">structure</span>(<span class="st">"bar"</span>, <span class="at">class =</span> <span class="st">"foobar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "foobar"</code></pre>
</div>
</div>
<p>Or you can define the class explicitelly as a <code>character</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+.character</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(x,y){<span class="fu">paste0</span>(x,y)}</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structure</span>(<span class="st">"foo"</span>, <span class="at">class =</span> <span class="st">"character"</span>) <span class="sc">+</span> <span class="fu">structure</span>(<span class="st">"bar"</span>, <span class="at">class =</span> <span class="st">"character"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "foobar"</code></pre>
</div>
</div>
<p>But it is better to not due this.</p>
<p>Another way is to overwrite the <code>+</code> function with user-defined function, but don’t do this either. If you think that the <code>+</code> semantics makes sense for strings, just define the <code>%+%</code> operator:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%+%</span><span class="st">`</span> <span class="ot">=</span> <span class="cf">function</span>(x,y){<span class="fu">paste0</span>(x,y)}</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="st">"foo"</span> <span class="sc">%+%</span> <span class="st">"bar"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "foobar"</code></pre>
</div>
</div>
<p>One famous case of using the operator <code>+</code> in a special way is to combine graphical elements in the <code>ggplot</code> package.</p>
<p>Operator overloading is especially useful for the equality operator <code>=</code>, but also for various subsetting operators <code>[</code> or <code>[[</code>, as well as for the replacement operators <code>[&lt;-</code>. We will talk about this next time.</p>
</section>
<section id="special-vs-builtin" class="level3">
<h3 class="anchored" data-anchor-id="special-vs-builtin">special vs builtin</h3>
<p>And just for completeness, Primitives and internal functions are also divided into <em>special</em> and <em>builtin</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>primitives <span class="ot">=</span> <span class="fu">Filter</span>(is.primitive, functions)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">split</span>(primitives <span class="sc">|&gt;</span> <span class="fu">names</span>(), <span class="fu">sapply</span>(primitives, typeof)) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(head, <span class="at">n=</span><span class="dv">10</span>, <span class="at">simplify=</span><span class="cn">FALSE</span>) <span class="co"># sample of bultin and specials</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$builtin
 [1] "-"   ":"   "!"   "!="  "("   "*"   "/"   "&amp;"   "%*%" "%/%"

$special
 [1] "::"   ":::"  "["    "[["   "[[&lt;-" "[&lt;-"  "{"    "@"    "@&lt;-"  "&amp;&amp;"  </code></pre>
</div>
</div>
<p>The difference between them is that <em>builtin</em> functions evaluate all their arguments before being passed to the internal implementation, while <em>special</em> don’t evaluate their arguments. When profiling, <em>builtin</em> functions are also counted as a function calls, while <em>special</em> aren’t. Only a small number of functions are trully special :). And while we can look which primitives are builtin or special, we can’t do so with internal functions. For instance, according to the documentation, <code>cbind</code> is special internal, while <code>grep</code> is builtin internal. But when you to get their type, all you get is a <code>closure</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"cbind"</span> <span class="ot">=</span> <span class="fu">typeof</span>(cbind), <span class="st">"grep"</span> <span class="ot">=</span> <span class="fu">typeof</span>(grep))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    cbind      grep 
"closure" "closure" </code></pre>
</div>
</div>
<p>Unless you want to join the development team of R, you do not need to know about this distinction.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Everything that happen in R is a function call, but for performance and parsing purpose, R has different types of functions. The classic functions in R are <em>closures</em>, but there are special kind of functions called <em>primitives</em>. Most operators are primitives and some primitives can also be generics, which connects them to the S3 dispatch system. This allows operators to be overloaded for user-defined classes, but not for basic types, despite not being typical S3 generics with <code>UseMethod()</code> call.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>For a more broad description of related ideas, see <a href="https://en.wikipedia.org/wiki/Generic_programming">https://en.wikipedia.org/wiki/Generic_programming</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>